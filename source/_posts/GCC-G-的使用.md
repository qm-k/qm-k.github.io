---
title: GCC-G++的使用
mathjax: false
date: 2020-03-21 19:44:11
tags:
- code
categories:
- linux
---
应广大群众的需求，整理一下编译工具的使用。
<!--more-->
Gcc&G++是GNU中的工具链，分别用来编译c&c++文件。
# 使用
```
$ gcc [options] [filenames] -o [targetfile]
$ g++ [options] [filenames] -o [targetfile]
```
options可以指定filenames文件编译的目标文件类型。  
使用`-o`可以指定编译结果的名字，当然不指定也可以，会有默认的名字。  
整个的编译流程为：
```mermaid
graph LR
A[.c]-->|预处理 -E|B[.i]
B -->|编译 -S| C[.s]
C -->|汇编 -c| D[.o]
D -->|链接 | E[可执行,默认为a.out]
```
# 参数
除了上边提到的`-E -S -c -o`之外还有一些别的参数可以使用。  
## -O
使用-O可以改变编译器对代码的优化等级，有时候不希望编译器在优化时改变我们的代码逻辑，这个时候可以用一个较低的优化等级`-O0`,-O指令可以加在g++&gcc指令后的任何地方，使用方式为-On（n 常为0--3）。  
优化等级越高，优化器对代码的改变也就越多，一般这个时候编译出来的可执行程序也就越快。  
每一个等级的优化内容稍有不同：

-O  主要进行跳转和延迟退栈两种优化；  

-O2 除了完成-O1的优化之外，还进行一些额外的调整工作，如指令调整等。  

-O3 则包括循环展开和其他一些与处理特性相关的优化工作。  

选项将使编译的速度比使用 -O 时慢， 但通常产生的代码执行速度会更快。  
## -l & -L
参考我之前的一篇文章：[pkg-config的使用](https://www.qm-k.xyz/2019/08/18/pkg-config%E7%9A%84%E4%BD%BF%E7%94%A8/)  
`-l`参数是用来指定需要的链接库的，比如我们需要用到一个`librknn_api.so`的动态链接库，这个时候我们可以把这个文件放进`/usr/lib`中使得g++之类的工具能找到他，然后在参数中添加`-lrknn_api`,如果和这个库配套的头文件也是没问题的我们就可以直接编译出结果。  
例如：
```
g++ XX.cpp -lrknn_api
```
这个时候相信你也可以看出来一个动态链接库的命名方式了，把他对应的`.so`文件去掉`lib`和`.so`，剩下的就是编译工具能识别到的库名。  
一般编译工具会在`/usr/lib`和`/usr/local/lib`文件夹中去找你需要的动态链接库，但是如果你的库不在这些路径下，这时候就需要使用`-L`来添加搜索路径，比如上边的`librknn_api.so`在`/usr/rknn/`目录下，就可以添加一个`-L/usr/rknn/`来使得编译工具能找到这个库。  
比如这个样子：
```
g++ XX.cpp -lrknn_api -L/usr/rknn/
```

经常编译一个开源源码遇到：
```
/usr/bin/ld: cannot find -lxxx”
```
一般就是需要安装一下对应的库即可解决问题。  

手工来写链接参数总是很麻烦的，还好很多库开发包提供了生成链接参数的程序，名字一般叫xxxx-config，一般放在/usr/bin目录下，比如 gtk1.2的链接参数生成程序是gtk-config，用法类似pkg-config，可以去看我之前专门讲这个的文章，现在基本都是支持pkg-config的，所以这个可以不管，了解一下。
## -i & -I
他们的功能和`-l & -L`功能类似，一个是添加头文件，一个是添加头文件路径，但是一般我们都在`.h`中使用`#include xxx.h`包含过了，所以主要就是用`-I`来声明头文件的目录，这个目录是可以用相对路径也可以用绝对路径的。  
用法和上边的-L一致，就不细说了。  
## -Wall、-w 和 -v参数
输出控制
```
    -Wall 打印出gcc提供的警告信息
    -w    关闭所有警告信息
    -v    列出所有编译步骤
```
## 相关
参考我之前的一篇文章：[pkg-config的使用](https://www.qm-k.xyz/2019/08/18/pkg-config%E7%9A%84%E4%BD%BF%E7%94%A8/)  
里边提到了一些像PKG_CONFIG_PATH这样用于pkg-config查找pc文件的环境变量说明可以看一下，同时还有后边要写的Makefile中的`CC`指定c编译器，`CXX`指定cxx编译器，CFLAGS等等。